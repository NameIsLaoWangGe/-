{
  "code": "import { Admin, TimerAdmin, Tools } from \"../Frame/Lwg\";\r\nimport { _LwgEvent } from \"../Frame/LwgEvent\";\r\nimport { _Game } from \"./_Game\";\r\nexport class _HeroWeapon extends Admin._ObjectBase {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.launchAcc = 0;\r\n        this.dropAcc = 0;\r\n        this.stateType = {\r\n            launch: 'launch',\r\n            free: 'free',\r\n        };\r\n    }\r\n    get state() {\r\n        return this['Statevalue'] ? this['Statevalue'] : 'launch';\r\n    }\r\n    ;\r\n    set state(_state) {\r\n        this['Statevalue'] = _state;\r\n    }\r\n    ;\r\n    getSpeed() {\r\n        return 20 + 0.1;\r\n    }\r\n    getDropSpeed() {\r\n        return this.dropAcc += 0.5;\r\n    }\r\n    lwgOnAwake() {\r\n        this.Pic = this._Owner.getChildByName('Pic');\r\n        TimerAdmin._frameLoop(1, this, () => {\r\n            this.move();\r\n        });\r\n    }\r\n    move() {\r\n        if (this.getSpeed() > 0) {\r\n            let p = Tools._Point.angleAndLenByPoint(this._Owner.rotation - 90, this.getSpeed());\r\n            this._Owner.x += p.x;\r\n            this._Owner.y += p.y;\r\n        }\r\n        else {\r\n            this._Owner.y += this.getDropSpeed();\r\n        }\r\n        const leave = Tools._Node.leaveStage(this._Owner, () => {\r\n            this._Owner.destroy();\r\n        });\r\n        if (!leave) {\r\n            if (!this._SceneImg('Content').parent) {\r\n                this.checkBoss();\r\n            }\r\n            else {\r\n                this.checkEnemy();\r\n            }\r\n        }\r\n    }\r\n    checkBoss() {\r\n        for (let index = 0; index < this._SceneImg('BossParent').numChildren; index++) {\r\n            const Enemy = this._SceneImg('BossParent').getChildAt(index);\r\n            if (this.displayArrow(Enemy, 50)) {\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    drop() {\r\n        this.state = this.stateType.free;\r\n        Laya.timer.clearAll(this);\r\n        TimerAdmin._frameLoop(1, this, () => {\r\n            this._Owner.y += 40;\r\n            this._Owner.rotation += 10;\r\n            Tools._Node.leaveStage(this._Owner, () => {\r\n                this._Owner.destroy();\r\n            });\r\n        });\r\n    }\r\n    displayArrow(Ele, dis) {\r\n        const EleParent = Ele.parent;\r\n        const elementGP = EleParent.localToGlobal(new Laya.Point(Ele.x, Ele.y));\r\n        if (elementGP.distance(this._gPoint.x, this._gPoint.y) < dis) {\r\n            this.state = this.stateType.free;\r\n            Laya.timer.clearAll(this);\r\n            const lP = Ele.globalToLocal(this._gPoint);\r\n            let ArrowParent;\r\n            const ran = Tools._Number.randomOneInt(0, 1);\r\n            if (ran == 0) {\r\n                ArrowParent = Ele.getChildByName('ArrowParentF');\r\n                if (!ArrowParent) {\r\n                    ArrowParent = new Laya.Sprite;\r\n                    ArrowParent.name = 'ArrowParentF';\r\n                    Ele.addChild(ArrowParent);\r\n                    ArrowParent.size(Ele.width, Ele.height);\r\n                    ArrowParent.cacheAs = \"bitmap\";\r\n                    ArrowParent.zOrder = 5;\r\n                    _Game._arrowParentArr.push(ArrowParent);\r\n                }\r\n            }\r\n            else {\r\n                ArrowParent = Ele.getChildByName('ArrowParentR');\r\n                if (!ArrowParent) {\r\n                    ArrowParent = new Laya.Sprite;\r\n                    ArrowParent.name = 'ArrowParentR';\r\n                    Ele.addChild(ArrowParent);\r\n                    ArrowParent.size(Ele.width, Ele.height);\r\n                    ArrowParent.cacheAs = \"bitmap\";\r\n                    ArrowParent.zOrder = -5;\r\n                    _Game._arrowParentArr.push(ArrowParent);\r\n                }\r\n            }\r\n            ArrowParent.addChild(this._Owner);\r\n            this._Owner.pos(lP.x, lP.y);\r\n            if (EleParent == this._SceneImg('Land') || EleParent == this._SceneImg('MiddleScenery') || EleParent == this._SceneImg('EnemyParent')) {\r\n                this._Owner.rotation -= Ele.rotation;\r\n                this._Owner.rotation -= this._SceneImg('Land').rotation;\r\n            }\r\n            else if (EleParent == this._SceneImg('Land')) {\r\n                this._Owner.rotation -= Ele.rotation;\r\n            }\r\n            this.Pic = this._Owner.getChildByName('Pic');\r\n            this.Pic.y -= Tools._Number.randomOneBySection(50);\r\n            const mask = new Laya.Sprite;\r\n            mask.size(200, 300);\r\n            mask.pos(0, Tools._Number.randomOneBySection(20, 30));\r\n            mask.loadImage('Lwg/UI/ui_l_orthogon_white.png');\r\n            this._Owner.mask = mask;\r\n            if (ArrowParent.numChildren > 20) {\r\n                const tex = ArrowParent.drawToTexture(ArrowParent.width, ArrowParent.height, 0, 0);\r\n                ArrowParent.texture && ArrowParent.texture.destroy(true);\r\n                ArrowParent.texture = tex;\r\n                for (let index = 0; index < ArrowParent.numChildren; index++) {\r\n                    const element = ArrowParent.getChildAt(index);\r\n                    element.destroy(true);\r\n                    index--;\r\n                }\r\n                _Game._texArr.push(tex);\r\n            }\r\n            if (Ele.name == 'Tree') {\r\n                this._evNotify(_LwgEvent.Game.treeBlood, [Ele, 1]);\r\n            }\r\n            else if (EleParent.name == 'EnemyParent' || EleParent.name == 'BossParent') {\r\n                this._evNotify(_LwgEvent.Game.enemyBlood, [Ele, 1]);\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n    checkEnemy() {\r\n        if (this.state == this.stateType.free) {\r\n            return;\r\n        }\r\n        for (let index = 0; index < this._SceneImg('MiddleScenery').numChildren; index++) {\r\n            const element = this._SceneImg('MiddleScenery').getChildAt(index);\r\n            if (element.name == 'Tree') {\r\n                if (this.displayArrow(element, 30)) {\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        if (this._SceneImg('FrontScenery').getChildByName('Stone')) {\r\n            for (let index = 0; index < this._SceneImg('FrontScenery').numChildren; index++) {\r\n                const element = this._SceneImg('FrontScenery').getChildAt(index);\r\n                if (element.name == 'Stone') {\r\n                    let gPStone = this._SceneImg('FrontScenery').localToGlobal(new Laya.Point(element.x, element.y));\r\n                    if (gPStone.distance(this._gPoint.x, this._gPoint.y) < 30) {\r\n                        this.drop();\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let index = 0; index < this._SceneImg('EnemyParent').numChildren; index++) {\r\n            const Enemy = this._SceneImg('EnemyParent').getChildAt(index);\r\n            let gPEnemy = this._SceneImg('EnemyParent').localToGlobal(new Laya.Point(Enemy.x, Enemy.y));\r\n            if (gPEnemy.distance(this._gPoint.x, this._gPoint.y) < 50) {\r\n                let Shell = Enemy.getChildByName('Shell');\r\n                if (Shell) {\r\n                    const landContentGP = this._SceneImg('Content').localToGlobal(new Laya.Point(this._SceneImg('Land').x, this._SceneImg('Land').y));\r\n                    let angle = Tools._Point.pointByAngle(landContentGP.x - this._gPoint.x, landContentGP.y - this._gPoint.y) + 90;\r\n                    if (210 < angle && angle < 330) {\r\n                        this.drop();\r\n                    }\r\n                    else {\r\n                        this.displayArrow(Enemy, 50);\r\n                    }\r\n                }\r\n                else {\r\n                    this.displayArrow(Enemy, 50);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        this.checkLand();\r\n    }\r\n    checkLand() {\r\n        let Ground;\r\n        const ran = Tools._Number.randomOneInt(0, 2);\r\n        const FrontGround = this._SceneImg('Land').getChildByName('FrontGround');\r\n        if (ran == 0) {\r\n            Ground = FrontGround;\r\n        }\r\n        else if (ran == 1) {\r\n            Ground = this._SceneImg('Land').getChildByName('MiddleGround');\r\n            if (!Ground) {\r\n                Ground = new Laya.Image;\r\n                Ground.name = 'MiddleGround';\r\n                this._SceneImg('Land').addChild(Ground);\r\n                Ground.zOrder = 14;\r\n            }\r\n        }\r\n        else if (ran == 2) {\r\n            Ground = this._SceneImg('Land').getChildByName('BehindGround');\r\n            if (!Ground) {\r\n                Ground = new Laya.Image;\r\n                Ground.name = 'BehindGround';\r\n                this._SceneImg('Land').addChild(Ground);\r\n                Ground.zOrder = 4;\r\n            }\r\n        }\r\n        Ground.size(FrontGround.width, FrontGround.height);\r\n        Ground.anchorX = Ground.anchorY = 0.5;\r\n        Ground.pos(FrontGround.x, FrontGround.y);\r\n        this.displayArrow(Ground, 160);\r\n    }\r\n}\r\n",
  "references": [
    "F:/Work/Game/07_RescueFlowerGirl_2.5.0/Project/RescueFlowerGirl_2.5.0/src/script/Frame/Lwg.ts",
    "F:/Work/Game/07_RescueFlowerGirl_2.5.0/Project/RescueFlowerGirl_2.5.0/src/script/Frame/LwgEvent.ts",
    "F:/Work/Game/07_RescueFlowerGirl_2.5.0/Project/RescueFlowerGirl_2.5.0/src/script/Game/_Buff.ts",
    "F:/Work/Game/07_RescueFlowerGirl_2.5.0/Project/RescueFlowerGirl_2.5.0/src/script/Game/_Game.ts"
  ]
}
